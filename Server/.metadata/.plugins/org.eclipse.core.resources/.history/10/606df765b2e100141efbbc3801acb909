package chuhan.gsp.hero;

import chuhan.gsp.ErrorType;
import chuhan.gsp.MsgType;
import chuhan.gsp.SErrorType;
import chuhan.gsp.attr.PropRole;
import chuhan.gsp.msg.Message;



public class PPeiYangHero extends xdb.Procedure{
	private final long roleid;
	private final int heroupkey;
	private final int herousekey;
	private final int ishigh; // 1是高级强化，0普通
	private final int isone; // 1是一键强化，0不是
	
	public PPeiYangHero(long roleid, int heroupkey, int herousekey, int ishigh, int isone) {
		this.roleid = roleid;
		this.heroupkey = heroupkey;
		this.herousekey = herousekey;
		this.ishigh = ishigh;
		this.isone = isone;

	}
	
	@Override
	protected boolean process() throws Exception {
		
		xbean.Properties xprop = xtable.Properties.get(roleid);
		if(xprop == null)
		{
			return false;
		}
		HeroColumn herocol = HeroColumn.getHeroColumn(roleid, false);
		
		int[] result = herocol.qianghuaEntry(this.heroupkey,  this.herousekey,this.ishigh);
		boolean bresult = false;
		SQianghuaHero snd = new SQianghuaHero();
		snd.ishigh = this.ishigh;
		snd.isone = this.isone;
		if(result == null)
			snd.result = SQianghuaHero.END_ERROR;
		else
		{
			snd.result = result[0];
			snd.notok_add = result[1];
			snd.notok_all = result[2];
			bresult = true;
			Hero hero = herocol.getHByHKey(heroupkey);
			PropRole propRole = PropRole.getPropRole(roleid, true);
			Message.broadcastMsgNotifyWithDelay(5000, MsgType.MSG_HERO_QIANGHUA,propRole.getProperties().getRolename(),hero.getiHeroInfo().getNameID(),String.valueOf(hero.getxHeroInfo().getQianghualevel()));

		}
		xdb.Procedure.psend(roleid, snd);
		
		return bresult;
	}
	
}
